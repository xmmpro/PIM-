<!-- src/app/ficha/ficha.html -->

<section class="page">
  <div class="container">
    <a class="back" routerLink="/chuletas">← Volver a Chuletas</a>

    <section class="wrap card" *ngIf="ficha; else notFound">
      <header class="hero">
        <h1>{{ ficha.titulo }}</h1>
        <p>{{ ficha.descripcion }}</p>
        <div class="heroActions">
          <button class="btn primary" type="button" (click)="toggleFav()">
            {{ isFav ? 'Guardada ★' : 'Guardar ☆' }}
          </button>

          <a class="btn" routerLink="/user" *ngIf="auth.isLoggedIn"> Ir a perfil → </a>
        </div>

        <div class="meta">
          <span class="pill cat">#{{ ficha.categoria }}</span>
          <span class="pill" *ngIf="ficha.nivel">{{ ficha.nivel }}</span>
          <span class="pill" *ngIf="ficha.updatedAt">Actualizado: {{ ficha.updatedAt }}</span>
        </div>
      </header>

      <div class="content">
        <aside class="toc">
          <h3>Índice</h3>

          <a *ngFor="let s of ficha.secciones" class="toc-link" [href]="'#' + s.id">
            {{ s.titulo }}
          </a>

          <div class="tags">
            <span class="tag" *ngFor="let t of ficha.tags">{{ t }}</span>
          </div>
        </aside>

        <main class="main">
          <section class="section" *ngFor="let s of ficha.secciones" [attr.id]="s.id">
            <div class="sec-head">
              <span class="pill sec-pill">#{{ ficha.categoria }}</span>
              <h2>{{ s.titulo }}</h2>
            </div>

            <article class="block" *ngFor="let b of s.bloques">
              <h4 *ngIf="b.titulo">{{ b.titulo }}</h4>
              <p *ngIf="b.texto">{{ b.texto }}</p>

              <pre class="code" *ngIf="b.codigo"><code>{{ b.codigo }}</code></pre>

              <ul *ngIf="b.notas?.length">
                <li *ngFor="let n of b.notas">{{ n }}</li>
              </ul>
            </article>
          </section>
        </main>
      </div>
    </section>

    <ng-template #notFound>
      <section class="card nf">
        <h2>No existe esa chuleta</h2>
        <p>La URL no coincide con ninguna ficha.</p>
        <a class="btn primary" routerLink="/chuletas">Volver a Chuletas</a>
      </section>
    </ng-template>
  </div>
</section>
